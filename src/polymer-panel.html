<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<!doctype html>

<html>
  <head>
    <link rel="import" href="../bower_components/polymer/polymer.html">
    <link rel="import" href="../bower_components/iron-icon/iron-icon.html">
    <link rel="import" href="../bower_components/iron-icons/iron-icons.html">
    <link rel="import" href="../bower_components/paper-button/paper-button.html">
    <link rel="import" href="../bower_components/paper-material/paper-material.html">
    <link rel="import" href="../bower_components/paper-styles/color.html">
    <link rel="import" href="../bower_components/paper-styles/shadow.html">
    <link rel="import" href="../bower_components/paper-styles/typography.html">
    <link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">
    <link rel="import" href="../bower_components/paper-tabs/paper-tabs.html">
    <link rel="import" href="../bower_components/paper-tabs/paper-tab.html">
    <link rel="import" href="elements/stats-table/stats-table.html">
    <link rel="import" href="elements/lifecycle-profiler/lifecycle-profiler.html">
    <link rel="import" href="elements/lifecycle-profiler/lifecycle-profiler-controls.html">
    <style is="custom-style">
      body {
        background: var(--paper-grey-100);
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <dom-module id="polymer-panel">
      <style>
      :host {
        color: var(--paper-blue-grey-900);
        --paper-input-container-color: var(--paper-blue-grey-300);
        --paper-input-container-focus-color: var(--paper-blue-grey-100);
        --paper-input-container-input-color: var(--paper-blue-grey-100);
      }
      app-toolbar {
        @apply(--shadow-elevation-4dp);
        background-color: var(--paper-blue-grey-500);
        color: var(--paper-blue-grey-100);
        justify-content: space-between;
      }
      paper-tabs {
        height: 64px;
      }

      #tools {
        display: block;
        margin: 1em;
      }
      </style>
      <template>
        <app-toolbar>
          <paper-tabs selected="{{tab}}">
            <paper-tab>Lifecycle Profiler</paper-tab>
          </paper-tabs>
          <iron-pages selected="[[tab]]">
            <lifecycle-profiler-controls></lifecycle-profiler-controls>
          </iron-pages>
        </app-toolbar>
        <iron-pages id="tools" selected="[[tab]]">
          <lifecycle-profiler></lifecycle-profiler>
        </iron-pages>
      </template>
      <script>
(function() {
  'use strict';

  Polymer({
    is: 'polymer-panel',

    properties: {
      tab: {
        type: Number,
        value: 0
      },

      stats: {
        type: Array,
      },

      allTagsStats: {
        type: Object,
      },
    },

    listeners: {
      'request-data': '_getData',
      'background-message': '_sendBackgroundMessage'
    },

    get tools() {
      return [].slice.call(Polymer.dom(this.$.tools).children);
    },

    attached() {
      this._backgroundPageConnection = chrome.runtime.connect({
        name: 'polymer-panel',
      });

      this._backgroundPageConnection.onMessage.addListener((message, sender) => {
        this.tools.forEach((tool) => tool.handleMessage(message));
      });

      // Register with the background page so it can send us messages based on
      // tab ID.
      this._backgroundPageConnection.postMessage({
        messageType: 'tab-id',
        tabId: chrome.devtools.inspectedWindow.tabId,
      });
      console.log(chrome.devtools.inspectedWindow);
    },

    _clearData() {
      this._backgroundPageConnection.postMessage({
        messageType: 'clear-element-stats',
        tabId: chrome.devtools.inspectedWindow.tabId,
      });
    },

    _getData() {
      console.log('getData');
      this._backgroundPageConnection.postMessage({
        messageType: 'get-element-stats',
        tabId: chrome.devtools.inspectedWindow.tabId,
      });
    },

    _sendBackgroundMessage(event) {
      let data = {
        messageType: event.detail.messageType,
        tabId: chrome.devtools.inspectedWindow.tabId,
        detail: event.detail.detail
      };
      console.log('sending background message', data);
      this._backgroundPageConnection.postMessage(data);
    }
  });
})();
      </script>
    </dom-module>
    <polymer-panel></polymer-panel>
  </body>
</html>
